<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Book Your Stay | Houseboat Canberra</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0f1113;
  --card:#15181c;
  --muted:#9aa4b2;
  --accent:#25D366;
  --border:#2a2f36;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:#fff;
  font-family:Inter,system-ui;
}

.wrapper{
  max-width:1100px;
  margin:auto;
  padding:40px 20px;
}

h1{font-size:2rem;margin-bottom:5px}
.subtitle{color:var(--muted);margin-bottom:30px}

.grid{
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:30px;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:24px;
}

.card h2{font-size:1.2rem;margin-bottom:20px}

.field{margin-bottom:15px}
label{font-size:.9rem;color:var(--muted)}

input,select{
  width:100%;
  padding:12px;
  margin-top:6px;
  background:#1d2026;
  border:1px solid var(--border);
  border-radius:8px;
  color:#fff;
  font-size:1rem;
}

.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:15px;
}

.summary{position:sticky;top:20px}

.price{
  font-size:2rem;
  font-weight:700;
  color:var(--accent);
  margin:10px 0;
  transition:transform .25s ease;
}
.price.updated{transform:scale(1.05)}

.small{font-size:.85rem;color:var(--muted)}

button{
  width:100%;
  padding:14px;
  margin-top:20px;
  border-radius:10px;
  border:none;
  font-size:1rem;
  font-weight:600;
  background:var(--accent);
  cursor:pointer;
}

button:disabled{
  opacity:.4;
  cursor:not-allowed;
}

.error{color:#ff6b6b}

@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}
</style>
</head>

<body>
<div class="wrapper">
  <h1>Book Your Stay</h1>
  <div class="subtitle">Secure your houseboat experience in just a few steps</div>

  <div class="grid">

    <!-- LEFT -->
    <div class="card">
      <h2>Stay Details</h2>

      <div class="field">
        <label>Room Type</label>
        <select id="room" disabled>
          <option>Loading room types…</option>
        </select>
      </div>

      <div class="field">
        <label>Meal Plan</label>
        <select id="meal" disabled>
          <option>Loading meal plans…</option>
        </select>
      </div>

      <div class="row">
        <div class="field">
          <label>Check-in</label>
          <input type="date" id="checkin">
        </div>
        <div class="field">
          <label>Check-out</label>
          <input type="date" id="checkout">
        </div>
      </div>

      <div class="small" id="nightInfo"></div>

      <div class="row">
        <div class="field">
          <label>Adults</label>
          <input type="number" id="adults" min="1" value="1">
        </div>
        <div class="field">
          <label>Children</label>
          <input type="number" id="children" min="0" value="0">
        </div>
      </div>

      <h2 style="margin-top:30px">Guest Information</h2>

      <div class="field">
        <label>Full Name</label>
        <input type="text" id="name">
      </div>

      <div class="field">
        <label>Email</label>
        <input type="email" id="email">
      </div>

      <div class="field">
        <label>Phone / WhatsApp</label>
        <input type="tel" id="phone">
      </div>

      <div class="field">
        <label>Special Requests</label>
        <input type="text" id="requests">
      </div>
    </div>

    <!-- RIGHT -->
    <div class="card summary">
      <h2>Price Summary</h2>
      <div class="small">Total payable amount</div>
      <div id="priceBox" class="price">$ 0</div>
      <div class="small">Inclusive of taxes</div>

      <button id="bookBtn" disabled>Confirm Booking</button>

      <div class="small" style="margin-top:15px">
        ✔ Instant confirmation<br>
        ✔ No hidden charges<br>
        ✔ Secure booking
      </div>
    </div>

  </div>
</div>

<script>
/************ CONFIG ************/
const API = "https://script.google.com/macros/s/YOUR_DEPLOYED_SCRIPT_ID/exec";
const CURRENCY = "$";

/************ HELPERS ************/
const $ = id => document.getElementById(id);
let lastTotal = 0;

/************ AUTO CHECKOUT ************/
$("checkin").addEventListener("change", e => {
  const d = new Date(e.target.value);
  d.setDate(d.getDate() + 1);
  $("checkout").value = d.toISOString().split("T")[0];
});

/************ LOAD OPTIONS ************/
async function loadOptions(){
  const res = await fetch(API,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({action:"getOptions"})
  });
  const data = await res.json();

  $("room").innerHTML = data.rooms.map(r=>`<option>${r}</option>`).join("");
  $("meal").innerHTML = data.meals.map(m=>`<option value="${m.code}">${m.code} - ${m.name}</option>`).join("");

  $("room").disabled = false;
  $("meal").disabled = false;
}

["room","meal","checkin","checkout","adults","children"]
.forEach(id=>$(id).addEventListener("change",calculate));

/************ CALCULATE ************/
async function calculate(){
  $("bookBtn").disabled = true;
  lastTotal = 0;

  if(!$("checkin").value || !$("checkout").value) return;

  const payload={
    action:"calculate",
    checkin:$("checkin").value,
    checkout:$("checkout").value,
    adults:+$("adults").value,
    children:+$("children").value,
    room:$("room").value,
    meal:$("meal").value
  };

  const res = await fetch(API,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(payload)
  });

  const data = await res.json();
  if(data.error) return;

  lastTotal = data.total;
  $("priceBox").innerText = `${CURRENCY} ${data.total}`;
  $("priceBox").classList.add("updated");
  setTimeout(()=>$("priceBox").classList.remove("updated"),200);

  $("nightInfo").innerText = `${data.nights} night(s) stay`;
  $("bookBtn").disabled = false;
}

/************ BOOK ************/
$("bookBtn").onclick = async ()=>{
  if(!$("name").value || !$("phone").value){
    alert("Please enter name and phone");
    return;
  }

  const payload={
    action:"book",
    checkin:$("checkin").value,
    checkout:$("checkout").value,
    room:$("room").value,
    meal:$("meal").value,
    adults:$("adults").value,
    children:$("children").value,
    total:lastTotal,
    name:$("name").value,
    phone:$("phone").value,
    email:$("email").value,
    requests:$("requests").value
  };

  const res = await fetch(API,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(payload)
  });

  const data = await res.json();
  alert(data.success ? "Booking Confirmed!" : "Booking Failed");
};

loadOptions();
</script>
</body>
</html>
